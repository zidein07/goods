var GoodsApp=angular.module("goodsApp",["ui.router","pascalprecht.translate"]).run(["$rootScope",function(t){t.$broadcast("cart")}]);GoodsApp.config(["$stateProvider","$locationProvider",function(t,e){function r(t){return"tpl/"+t+".html"}t.state("goods",{url:"/",controller:"GoodsCtrl",templateUrl:r("goods")}).state("about",{url:"/about",controller:"AboutCtrl",templateUrl:r("about")}).state("cart",{url:"/cart",controller:"CartCtrl",templateUrl:r("cart")}),e.hashPrefix(""),e.html5Mode({enabled:!1,requireBase:!1})}]),GoodsApp.config(["$translateProvider",function(t){t.translations("en",{PARSER_TITLE:"Wall parsing in",SHIPS:"Spaceships",ABOUT:"About",CART:"Cart`s ship",PRICE:"Price",REMOVE:"Remove",NAME:"NAME",GOODS:"Goods"}).translations("ru",{PARSER_TITLE:"Парсинг стены",SHIPS:"Космические корабли",ABOUT:"О Проекте",CART:"Корзина",PRICE:"Цена",REMOVE:"Удалить",NAME:"Название",GOODS:"Товаров"}).registerAvailableLanguageKeys(["en","ru"],{"en_*":"en","ru_*":"ru","*":"ru"}).preferredLanguage("ru")}]),GoodsApp.controller("AboutCtrl",["$scope","GoodsApiService",function(t,e){}]),GoodsApp.controller("CartCtrl",["$scope","$storage","$rootScope",function(t,e,r){t.goods=e.getItem("ships"),t.removeGood=function(o){t.goods=e.removeItem("ships",o,"name"),r.$emit("cart")}}]),GoodsApp.controller("GoodsCtrl",["$scope","GoodsApiService","$storage","$rootScope",function(t,e,r,o){function n(t){var e=r.getItem("ships");return t=_.map(t,function(t){return t.price=_.random(1e3,99999),t.inCart=_.some(e,{name:t.name}),t})}t.ships=[],t.loremTpl="<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Deserunt distinctio dolorem dolorum eius harum in minus non nostrum pariatur, perspiciatis porro quasi, quos repellendus saepe tempore tenetur totam velit vitae?</p>",e.getGoods().then(function(e){if(e.hasNotResults())return!1;t.ships=n(e.getResults())}),t.addToCart=function(t){t.inCart?r.removeItem("ships",t,"name"):r.pushItem("ships",{name:t.name,price:t.price}),o.$emit("cart"),t.inCart=!t.inCart}}]),GoodsApp.controller("HeaderCtrl",["$scope","$translate","$storage","$rootScope",function(t,e,r,o){t.languages=[{val:"ru",lang:"Русский"},{val:"en",lang:"English"}],t.currentLang=function(){var t=r.getItem("lang");return t||"ru"}(),o.$on("cart",function(){t.goods=r.getItem("ships")}),t.goods=r.getItem("ships"),t.setCurrentLang=function(t,o){e.use(t),o||r.setItem("lang",t)},t.setCurrentLang(t.currentLang,!0)}]),GoodsApp.directive("headerDirective",[function(){return{restrict:"E",replace:!0,templateUrl:"tpl/header.html",controller:"HeaderCtrl",scope:{props:"="}}}]),GoodsApp.filter("sum",[function(){return function(t,e){return e?_.sumBy(t,e):_.sumBy(t)}}]),GoodsApp.filter("trustHtml",["$sce",function(t){return function(e){return t.trustAsHtml(e)}}]),GoodsApp.factory("GoodsApiService",["$http","GoodsApiResponseService",function(t,e){function r(t){return e(t.data)}return{buildLink:function(t){return"/"+t},getGoods:function(e){return t({url:"http://swapi.co/api/starships/",method:"GET",params:e}).then(r)}}}]),GoodsApp.service("GoodsApiResponseService",function(){var t=function(t){this.response=t,this.errorStatus=!1,this.errorType=null,this.errorCode=null,this.errorMessage=null};return t.prototype.getResults=function(){return this.response.results},t.prototype.hasResults=function(){return!_.isEmpty(this.response.results)},t.prototype.hasNotResults=function(){return _.isEmpty(this.response.results)},t.prototype.getNextLink=function(){return this.response.next},t.prototype.getPrevLink=function(){return this.response.next},t.prototype.getCount=function(){return this.response.count},function(e){return new t(e)}}),GoodsApp.factory("$storage",[function(){return{removeItem:function(t,e,r){return this.setItem(t,_.filter(this.getItem(t),function(t){return t[r]!==e[r]})),this.getItem(t)},pushItem:function(t,e){var r=this.getItem(t),o=_.isEmpty(r)?[]:r;return o.push(e),this.setItem(t,o),_.size(o)},setItem:function(t,e){localStorage.setItem(t,JSON.stringify(e))},getItem:function(t){return JSON.parse(localStorage.getItem(t))}}}]);