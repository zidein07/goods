var GoodsApp=angular.module("goodsApp",["ui.router","pascalprecht.translate","ui.bootstrap"]).run(["$rootScope",function(t){t.$broadcast("cart")}]);GoodsApp.config(["$stateProvider","$locationProvider","$urlRouterProvider",function(t,e,r){function o(t){return"tpl/"+t+".html"}t.state("cart",{url:"/cart",controller:"CartCtrl",templateUrl:o("cart")}).state("goods",{url:"/",controller:"GoodsCtrl",templateUrl:o("goods")}),e.hashPrefix(""),r.otherwise("/")}]),GoodsApp.config(["$translateProvider",function(t){t.translations("en",{PARSER_TITLE:"Wall parsing in",SHIPS:"Spaceships",ABOUT:"About",CART:"Cart`s ship",PRICE:"Price",REMOVE:"Remove",NAME:"NAME",GOODS:"Goods",RELOAD_LIST:"Reload list",TOTAL:"Total:",MAKE_ORDER:"Make order",YOUR_FULL_NAME:"Your full name",YOUR_ADDRESS:"Your address",DATE:"Date",SEND:"Send",CART_EMPTY_DESCRIPTION:'<p>Your cart is empty, but you can buy <b>luke skywalker`s ship</b> redirect to this <a href="#/">page</a></p>',CONFIRM_AN_ORDER:"Confirmation of an order",LOADING:"Loading",DESCRIPTION_OF_SPACESHIP:"<p>Description of the spaceship</p>"}).translations("ru",{PARSER_TITLE:"Парсинг стены",SHIPS:"Космические корабли",ABOUT:"О Проекте",CART:"Корзина",PRICE:"Цена",REMOVE:"Удалить",NAME:"Название",GOODS:"Товаров",RELOAD_LIST:"Обновить список",TOTAL:"Итого:",MAKE_ORDER:"Заказать",YOUR_FULL_NAME:"Ваше полное имя",YOUR_ADDRESS:"Ваш адрес",DATE:"Дата",SEND:"Отправить",CART_EMPTY_DESCRIPTION:'<p>Ваша корзина пуста, но вы можете приобрести <b>космический корабль Люка Скайвокера</b> для этого перейдите на эту <a href="#/">страницу</a></p>',CONFIRM_AN_ORDER:"Подтверждение заказа",LOADING:"Загрузка",DESCRIPTION_OF_SPACESHIP:"<p>Какое-то описание об этом корабле</p>"}).registerAvailableLanguageKeys(["en","ru"],{"en_*":"en","ru_*":"ru","*":"ru"}).preferredLanguage("ru")}]),GoodsApp.controller("CartCtrl",["$scope","$storage","$rootScope","PopupService",function(t,e,r,o){t.goods=e.getItem("ships"),t.removeGood=function(o){t.goods=e.removeItem("ships",o,"name"),r.$emit("cart")},t.takeOrder=function(){o.cartOrder()}}]),GoodsApp.controller("GoodsCtrl",["$scope","GoodsApiService","$storage","$rootScope","$interval","$spinner",function(t,e,r,o,n,s){function i(t){var e=r.getItem("ships");return t=_.map(t,function(t){return t.price=_.random(1e3,99999),t.inCart=_.some(e,{name:t.name}),t})}t.loadGoods=function(){s.show(),t.ships=[],e.getGoods().then(function(e){if(s.hide(),e.hasNotResults())return!1;t.ships=i(e.getResults())})},n(function(){t.loadGoods()},6e4),t.loadGoods(),t.addToCart=function(t){t.inCart?r.removeItem("ships",t,"name"):r.pushItem("ships",{name:t.name,price:t.price}),o.$emit("cart"),t.inCart=!t.inCart}}]),GoodsApp.directive("headerDirective",[function(){return{restrict:"E",replace:!0,templateUrl:"tpl/header.html",controller:"HeaderCtrl",scope:{props:"="}}}]),GoodsApp.directive("spinnerPage",[function(){return{restrict:"E",replace:!0,templateUrl:"tpl/spinner.html"}}]),GoodsApp.filter("sum",[function(){return function(t,e){return e?_.sumBy(t,e):_.sumBy(t)}}]),GoodsApp.filter("trustHtml",["$sce",function(t){return function(e){return t.trustAsHtml(e)}}]),GoodsApp.factory("GoodsApiService",["$http","GoodsApiResponseService",function(t,e){function r(t){return e(t.data)}return{buildLink:function(t){return"/"+t},getGoods:function(e){return t({url:"http://swapi.co/api/starships/",method:"GET",params:e}).then(r)}}}]),GoodsApp.service("GoodsApiResponseService",function(){var t=function(t){this.response=t,this.errorStatus=!1,this.errorType=null,this.errorCode=null,this.errorMessage=null};return t.prototype.getResults=function(){return this.response.results},t.prototype.hasResults=function(){return!_.isEmpty(this.response.results)},t.prototype.hasNotResults=function(){return _.isEmpty(this.response.results)},t.prototype.getNextLink=function(){return this.response.next},t.prototype.getPrevLink=function(){return this.response.next},t.prototype.getCount=function(){return this.response.count},function(e){return new t(e)}}),GoodsApp.factory("$storage",[function(){return{removeItem:function(t,e,r){return this.setItem(t,_.filter(this.getItem(t),function(t){return t[r]!==e[r]})),this.getItem(t)},pushItem:function(t,e){var r=this.getItem(t),o=_.isEmpty(r)?[]:r;return o.push(e),this.setItem(t,o),_.size(o)},setItem:function(t,e){localStorage.setItem(t,JSON.stringify(e))},remove:function(t){this.setItem(t,null)},getItem:function(t){return JSON.parse(localStorage.getItem(t))}}}]),GoodsApp.factory("PopupService",["$uibModal","$uibModalStack",function(t,e){return{cartOrder:function(){return t.open({templateUrl:"tpl/popups/cart/cart-order.html",controller:"CartOrderCtrl",size:"lg"}).result.then(function(){},function(){})}}}]),GoodsApp.factory("$spinner",[function(){return{show:function(){$(".bkg-sk-fading-circle").show()},hide:function(){$(".bkg-sk-fading-circle").hide()}}}]),GoodsApp.controller("HeaderCtrl",["$scope","$translate","$storage","$rootScope",function(t,e,r,o){function n(t){var e=r.getItem(t);return e||[]}t.languages=[{val:"ru",lang:"Русский"},{val:"en",lang:"English"}],t.currentLang=function(){var t=r.getItem("lang");return t||"ru"}(),o.$on("cart",function(){t.goods=n("ships")}),t.goods=n("ships"),t.setCurrentLang=function(t,o){e.use(t),o||r.setItem("lang",t)},t.setCurrentLang(t.currentLang,!0)}]),GoodsApp.controller("CartOrderCtrl",["$scope","$storage","$location","$uibModalStack","$rootScope",function(t,e,r,o,n){function s(){o.dismissAll()}var i=new Date;i.setDate(i.getDate()+1),t.dateOrder=new Date(i),t.sendOrder=function(t){console.log("data",t),e.remove("ships"),n.$emit("cart"),r.url("/"),s()},t.closePopup=function(){s()}}]);